# NIHMS API Token Refresh

The NIHMS harvester process requires an Authentication token.  This token is available from the PACM utils page and is
valid for three months.  There is currently no API available to refresh the token.  

This module is an RPA to automate the generation of a new API Token and set the token into a store. The default store 
is an AWS Parameter Store, but you can update the entrypoint.sh file with a new script if needed. The Token is 
generated by running the TestCafe script that logs into the PACM utils page using th ERA Commons login option, clicks 
on the API Token link, and writes the new token to a file named in the `NIHMS_OUTFILE` environment variable.  The 
value in the `NIHMS_OUTFILE` file is then set into the parameter store.

There is a Docker image built and pushed named ghcr.io/eclipse-pass/pass-nihms-token-refresh:<version>.

In order tun the token refresh RPA, the following needs to be passed to the docker image as environment variables:

`NIHMS_USER` : The ERA Commons login username  
`NIHMS_PASSWORD` : The ERA Commons login password  
`NIHMS_OUTFILE` : The full path to the file to write the new token

If you are setting the token into AWS Parameter Store, the script assumes that the needed aws cli authentication are in
place such as passing the AWS env vars or assumed roles.

